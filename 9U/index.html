<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kickapoo Tribe Baseball - 10U</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #F3BB21;
            color: #4E321E;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #4E321E;
            color: #F3BB21;
            padding: 20px;
            text-align: center;
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .main-container {
            display: flex;
            flex-wrap: wrap;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 10px;
        }
        .sidebar {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border: 2px solid #4E321E;
            border-radius: 8px;
            padding: 20px;
            margin-right: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            position: relative;
        }
        .sidebar h2 {
            margin-top: 0;
            font-size: 1.5em;
        }
        .song-list-container {
            min-height: 100px;
        }
        .song-entry {
            background-color: #F3BB21;
            border: 1px solid #4E321E;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        .song-entry button {
            background-color: #4E321E;
            color: #F3BB21;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            margin-left: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .song-entry button:hover {
            background-color: #3a2415;
        }
        .song-entry button:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        .admin-button {
            background-color: #4E321E;
            color: #F3BB21;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            font-size: 0.8em;
            cursor: pointer;
            margin-top: 10px;
            display: block;
            position: absolute;
            bottom: 20px;
            width: calc(100% - 40px);
        }
        .admin-button:hover {
            background-color: #3a2415;
        }
        .form-container {
            flex: 2;
            min-width: 300px;
            background-color: white;
            border: 2px solid #4E321E;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"] {
            width: 80%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #4E321E;
            border-radius: 5px;
            font-size: 1em;
        }
        button {
            background-color: #4E321E;
            color: #F3BB21;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
        }
        button:hover {
            background-color: #3a2415;
        }
        .error-message, .info-box {
            color: #4E321E;
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #4E321E;
            border-radius: 5px;
        }
        .info-box {
            background-color: #fff;
            font-style: italic;
        }
        footer {
            background-color: #4E321E;
            color: #F3BB21;
            padding: 15px;
            text-align: center;
            font-size: 0.9em;
            margin-top: 20px;
            border-top: 2px solid #F3BB21;
        }
        footer p {
            margin: 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Kickapoo Tribe Baseball - 10U </h1>
    </header>

    <div class="main-container">
        <!-- Sidebar for Displaying Songs -->
        <div class="sidebar">
            <h2>Player Details</h2>
            <div class="song-list-container">
                <div id="songList"></div>
            </div>
            <button id="adminButton" class="admin-button" onclick="toggleAdminMode()">26</button>
        </div>
      <!-- Footer with Disclaimer -->
    <footer>
        <p><strong>Disclaimer:</strong> The information on this site is provided for convenience and entertainment purposes only. While we strive to update the walkout song selections and player details before each game, changes may occur without notice. For the most accurate and up-to-date information, please consult your head coach at the field. This site was created by the parent of player #26. We are not responsible for any errors, omissions, or discrepancies in the information provided. This site and its content are not intended for use in sports betting, gambling, or any related activities. Any such use is strictly prohibited.</p>
    </footer>

    <script>
        let isAdmin = false;
        const SECRET_CODE = "kickapoo2025";
        const TIMEOUT = 60 * 1000;
        let lastAdditionTime = null;
        const GOOGLE_SHEETS_API = "https://script.google.com/macros/s/AKfycbxQjRuwSjsNruROYejtn9dDbr9SrbE7J50THS8A9trmNDs6XRmjk8KQ-dQGkCs9VoTP/exec";

        // Load songs from Google Sheets when the page loads
        document.addEventListener("DOMContentLoaded", () => {
            fetchSongs();
            setInterval(checkTimers, 1000);
        });

        // Fetch songs from Google Sheets
        async function fetchSongs() {
            try {
                const response = await fetch(GOOGLE_SHEETS_API, { mode: 'cors' });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                const songs = await response.json();
                displaySongs(songs);
            } catch (error) {
                console.error("Error fetching songs:", error);
                document.getElementById("songList").innerHTML = "<p>Error loading songs: " + error.message + ". Check console for details or ensure the web app URL is correct.</p>";
            }
        }

       
// Wait 2 seconds (increased delay for reliability) and then fetch updated songs
        
                setTimeout(() => {
                    fetchSongs().then(updatedSongs => {
                        lastAdditionTime = new Date().getTime();
                        displaySongs(updatedSongs);
                        document.getElementById("songForm").reset();
                        document.getElementById("errorMessage").textContent = "";
                    }).catch(error => {
                        console.error("Error fetching songs after adding:", error);
                        document.getElementById("errorMessage").textContent = `Error after adding song: ${error.message}. Check console for details.`;
                    }).finally(() => {
                        document.body.removeChild(form);
                    });
                }, 2000);
            }).catch(error => {
                console.error("Error fetching songs before adding:", error);
                document.getElementById("errorMessage").textContent = `Error adding song: ${error.message}. Check console for details.`;
            });
        }

// Helper function to fetch songs and return them
        
        async function fetchSongsAndReturn() {
            try {
                const response = await fetch(GOOGLE_SHEETS_API, { mode: 'cors' });
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                const data = await response.json();
                if (data.error) {
                    throw new Error(`Server error: ${data.error}`);
                }
                return data;
            } catch (error) {
                console.error("Error fetching songs:", error);
                throw error;
            }
        }

// Display the song list, sorted by battingOrder
        
        function displaySongs(songs) {
            const songList = document.getElementById("songList");
            songList.innerHTML = "";
            if (!songs || songs.length === 0) {
                songList.innerHTML = "<p>No songs selected yet.</p>";
            } else {
                // Sort songs by battingOrder (ascending)
                songs.sort((a, b) => parseInt(a.battingOrder) - parseInt(b.battingOrder));

                songs.forEach((song, index) => {
                    const songDiv = document.createElement("div");
                    songDiv.className = "song-entry";
                    songDiv.innerHTML = `Child: ${song.childName} (#${song.childNumber})<br>Starting Position: ${song.startingPosition}<br>Batting Order: ${song.battingOrder}<br>Walkout Song: "${song.walkoutSongName}" by ${song.walkoutSongArtistName}<br>Starting at: ${song.startingSecond} seconds<br>`;
                    const editButton = document.createElement("button");
                    editButton.textContent = "Edit";
                    const currentTime = new Date().getTime();
                    const timeElapsed = currentTime - (lastAdditionTime || currentTime);
                    editButton.disabled = !isAdmin && (timeElapsed > TIMEOUT);
                    editButton.onclick = () => editSong(index);
                    songDiv.appendChild(editButton);

                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "Delete";
                    deleteButton.disabled = !isAdmin && (timeElapsed > TIMEOUT);
                    deleteButton.onclick = () => deleteSong(index);
                    songDiv.appendChild(deleteButton);

                    songList.appendChild(songDiv);
                });
            }
        }

// Check timers periodically
        
        function checkTimers() {
            fetchSongs();
        }
   </script>
</body>
</html>
